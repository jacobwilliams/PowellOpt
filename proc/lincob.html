<!-- -*- mode: jinja2 -*- -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="PowellOpt -- Optimization algorithms by M.J.D. Powell">
    <meta name="author" content="Jacob Williams" >
    <link rel="icon" href="../favicon.png">

    <title>lincob &ndash; PowellOpt</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
      <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">

    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>
  </head>

  <body>

    <!-- Fixed navbar -->
    <div class="container-fluid mb-sm-4 mb-xl-2">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
          <a class="navbar-brand" href="../index.html">PowellOpt </a>
          <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar"
                  aria-expanded="false" aria-controls="navbar" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon">
          </button>

          <div id="navbar" class="navbar-collapse collapse">
            <ul class="navbar-nav">
                  <li class="nav-item">
                    <a class="nav-link" href="../lists/files.html">Source Files</a>
                  </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/modules.html">Modules</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/procedures.html">Procedures</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/absint.html">Abstract Interfaces</a>
                </li>
            </ul>
              <div class="d-flex align-items-end flex-grow-1">
                <form action="../search.html" role="search" class="ms-auto">
                  <input type="text" class="form-control" aria-label="Search" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
                </form>
              </div>
          </div><!--/.nav-collapse -->
        </div>
      </nav>
    </div>

    <div class="container">
  <div class="row">
    <h1>lincob
      <small>Subroutine</small>
      
    </h1>
      <div class="container p-2 mb-4 bg-light border rounded-3">
    <div class="row align-items-center justify-content-between" id="info-bar">
      <div class="col">
        <ul class="list-inline" style="margin-bottom:0px;display:inline">

            <li class="list-inline-item" id="statements"><i class="fa fa-list-ol"></i>
              <a data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-html="true"
                 title=" 6.8% of total for procedures.">421 statements</a>
            </li>

            <li class="list-inline-item" id="source-file">
              <i class="fa fa-code"></i>
              <a href="../src/lincoa.f90"> Source File</a>
            </li>
        </ul>
      </div>
      <div class="col">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb justify-content-end mb-0">
                <li class="breadcrumb-item"><a href='../sourcefile/lincoa.f90.html'>lincoa.f90</a></li>
                <li class="breadcrumb-item"><a href='../module/lincoa_module.html'>lincoa_module</a></li>
            <li class="breadcrumb-item active" aria-current="page">lincob</li>
          </ol>
        </nav>
      </div>
    </div>
  </div>
  <script>
    $(function () {
    $('[data-bs-toggle="tooltip"]').tooltip()
    })
  </script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
      <div id="sidebar">
      <h3>Contents</h3>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    <div class="card card-primary">
      <div class="card-header text-left"><h3 class="card-title">Source Code</h3></div>
      <div class="list-group">
        <a class="list-group-item" href="../proc/lincob.html#src">lincob</a>
      </div>
    </div>


  </div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>private  subroutine lincob(n, npt, m, amat, b, x, rhobeg, rhoend, iprint, maxfun, xbase, xpt, fval, xsav, xopt, gopt, hq, pq, bmat, zmat, ndim, step, sp, xnew, iact, rescon, qfac, rfac, pqw, w, calfun)  
</h2>
    



    <h3>Arguments</h3>
        <table class="table table-striped varlist">
    <thead>
      <tr>
        <th scope="col">Type</th>
<th scope="col">Intent</th><th scope="col">Optional</th>        <th scope="col">Attributes</th>
        <th scope="col"></th>
        <th scope="col">Name</th>
        <th scope="col"></th>
    </thead>
    <tbody>
        <tr>
            <td>
              <span class="anchor" id="variable-n~18"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>n</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-npt~9"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>npt</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-m~8"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>m</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-amat"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>amat</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-b~3"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>b</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-x~13"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>x</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rhobeg~8"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>rhobeg</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rhoend~8"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>rhoend</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-iprint~8"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>iprint</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-maxfun~8"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>maxfun</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-xbase~2"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>xbase</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-xpt~5"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>xpt</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-fval~2"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>fval</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-xsav"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>xsav</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-xopt~6"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>xopt</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-gopt"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>gopt</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-hq~3"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>hq</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-pq~3"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>pq</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-bmat~5"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>bmat</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-zmat~5"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>zmat</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-ndim~7"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>ndim</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-step~2"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>step</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-sp"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>sp</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-xnew~2"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>xnew</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-iact~5"></span>
              integer
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>iact</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rescon"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>rescon</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-qfac"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>qfac</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-rfac"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>rfac</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-pqw"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>pqw</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-w~9"></span>
              real
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>w</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-calfun~5"></span>
              procedure(<a href='../interface/func~3.html'>func</a>)
            </td>
<td></td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>calfun</strong></td>
            <td>
                
            </td>
        </tr>
    </tbody>
  </table>

    <br>
    <div class="card">
      <div class="card-header">
  <h3 class="card-title">Calls</h3>
      </div>
      <div class="card-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: proc~~lincob~~CallsGraph Pages: 1 -->
<svg id="proclincobCallsGraph" width="242pt" height="154pt"
 viewBox="0.00 0.00 242.00 154.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~lincob~~CallsGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 150)">
<title>proc~~lincob~~CallsGraph</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-150 238,-150 238,4 -4,4"/>
<!-- proc~lincob -->
<g id="proc~~lincob~~CallsGraph_node1" class="node">
<title>proc~lincob</title>
<polygon fill="none" stroke="black" points="54,-84 0,-84 0,-60 54,-60 54,-84"/>
<text text-anchor="middle" x="27" y="-69.6" font-family="Helvetica,sans-Serif" font-size="10.50">lincob</text>
</g>
<!-- proc~prelim -->
<g id="proc~~lincob~~CallsGraph_node2" class="node">
<title>proc~prelim</title>
<g id="a_proc~~lincob~~CallsGraph_node2"><a xlink:href="../proc/prelim.html" xlink:title="prelim">
<polygon fill="#d9534f" stroke="#d9534f" points="144,-146 90,-146 90,-122 144,-122 144,-146"/>
<text text-anchor="middle" x="117" y="-131.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">prelim</text>
</a>
</g>
</g>
<!-- proc~lincob&#45;&gt;proc~prelim -->
<g id="proc~~lincob~~CallsGraph_edge1" class="edge">
<title>proc~lincob&#45;&gt;proc~prelim</title>
<path fill="none" stroke="#000000" d="M45.39,-84.25C58.24,-93.31 75.96,-105.79 90.43,-115.99"/>
<polygon fill="#000000" stroke="#000000" points="88.76,-119.09 98.95,-121.99 92.79,-113.37 88.76,-119.09"/>
</g>
<!-- proc~qmstep -->
<g id="proc~~lincob~~CallsGraph_node3" class="node">
<title>proc~qmstep</title>
<g id="a_proc~~lincob~~CallsGraph_node3"><a xlink:href="../proc/qmstep.html" xlink:title="qmstep">
<polygon fill="#d9534f" stroke="#d9534f" points="144,-104 90,-104 90,-80 144,-80 144,-104"/>
<text text-anchor="middle" x="117" y="-89.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">qmstep</text>
</a>
</g>
</g>
<!-- proc~lincob&#45;&gt;proc~qmstep -->
<g id="proc~~lincob~~CallsGraph_edge2" class="edge">
<title>proc~lincob&#45;&gt;proc~qmstep</title>
<path fill="none" stroke="#000000" d="M54.4,-78C62.48,-79.84 71.51,-81.89 80.1,-83.84"/>
<polygon fill="#000000" stroke="#000000" points="79.39,-87.27 89.92,-86.07 80.94,-80.44 79.39,-87.27"/>
</g>
<!-- proc~trstep -->
<g id="proc~~lincob~~CallsGraph_node4" class="node">
<title>proc~trstep</title>
<g id="a_proc~~lincob~~CallsGraph_node4"><a xlink:href="../proc/trstep.html" xlink:title="trstep">
<polygon fill="#d9534f" stroke="#d9534f" points="144,-24 90,-24 90,0 144,0 144,-24"/>
<text text-anchor="middle" x="117" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">trstep</text>
</a>
</g>
</g>
<!-- proc~lincob&#45;&gt;proc~trstep -->
<g id="proc~~lincob~~CallsGraph_edge3" class="edge">
<title>proc~lincob&#45;&gt;proc~trstep</title>
<path fill="none" stroke="#000000" d="M45.81,-59.86C58.45,-51.24 75.63,-39.52 89.83,-29.84"/>
<polygon fill="#000000" stroke="#000000" points="91.93,-32.65 98.22,-24.12 87.98,-26.87 91.93,-32.65"/>
</g>
<!-- proc~update~2 -->
<g id="proc~~lincob~~CallsGraph_node5" class="node">
<title>proc~update~2</title>
<g id="a_proc~~lincob~~CallsGraph_node5"><a xlink:href="../proc/update~2.html" xlink:title="update">
<polygon fill="#d9534f" stroke="#d9534f" points="234,-106 180,-106 180,-82 234,-82 234,-106"/>
<text text-anchor="middle" x="207" y="-91.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">update</text>
</a>
</g>
</g>
<!-- proc~lincob&#45;&gt;proc~update~2 -->
<g id="proc~~lincob~~CallsGraph_edge4" class="edge">
<title>proc~lincob&#45;&gt;proc~update~2</title>
<path fill="none" stroke="#000000" d="M54.03,-69.04C77.7,-67 113.47,-65.52 144,-71 152.69,-72.56 161.75,-75.26 170.18,-78.27"/>
<polygon fill="#000000" stroke="#000000" points="169.14,-81.62 179.73,-81.9 171.63,-75.07 169.14,-81.62"/>
</g>
<!-- proc~prelim&#45;&gt;proc~update~2 -->
<g id="proc~~lincob~~CallsGraph_edge5" class="edge">
<title>proc~prelim&#45;&gt;proc~update~2</title>
<path fill="none" stroke="#000000" d="M144.4,-122C152.66,-118.25 161.9,-114.05 170.66,-110.06"/>
<polygon fill="#000000" stroke="#000000" points="172.26,-113.18 179.92,-105.86 169.37,-106.81 172.26,-113.18"/>
</g>
<!-- proc~getact -->
<g id="proc~~lincob~~CallsGraph_node6" class="node">
<title>proc~getact</title>
<g id="a_proc~~lincob~~CallsGraph_node6"><a xlink:href="../proc/getact.html" xlink:title="getact">
<polygon fill="#d9534f" stroke="#d9534f" points="234,-24 180,-24 180,0 234,0 234,-24"/>
<text text-anchor="middle" x="207" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">getact</text>
</a>
</g>
</g>
<!-- proc~trstep&#45;&gt;proc~getact -->
<g id="proc~~lincob~~CallsGraph_edge6" class="edge">
<title>proc~trstep&#45;&gt;proc~getact</title>
<path fill="none" stroke="#000000" d="M144.4,-12C152.39,-12 161.31,-12 169.82,-12"/>
<polygon fill="#000000" stroke="#000000" points="169.92,-15.5 179.92,-12 169.92,-8.5 169.92,-15.5"/>
</g>
</g>
</svg>
</div>          <div>
            <a type="button" class="graph-help" data-bs-toggle="modal" href="#CallsGraph-help-text">Help</a>
          </div>
          <div class="modal fade" id="CallsGraph-help-text" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-lg" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
<p>Nodes of different colours represent the following: </p>
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="641pt" height="28pt"
 viewBox="0.00 0.00 641.00 27.51" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.86 0.86) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-28 741.5,-28 741.5,4 -4,4"/>
<!-- Subroutine -->
<g id="node1" class="node">
<title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="70,-24 0,-24 0,0 70,0 70,-24"/>
<text text-anchor="middle" x="35" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Subroutine</text>
</g>
<!-- Function -->
<g id="node2" class="node">
<title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="146,-24 88,-24 88,0 146,0 146,-24"/>
<text text-anchor="middle" x="117" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Function</text>
</g>
<!-- Interface -->
<g id="node3" class="node">
<title>Interface</title>
<polygon fill="#a7506f" stroke="#a7506f" points="225.5,-24 164.5,-24 164.5,0 225.5,0 225.5,-24"/>
<text text-anchor="middle" x="195" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Interface</text>
</g>
<!-- Type Bound Procedure -->
<g id="node4" class="node">
<title>Type Bound Procedure</title>
<polygon fill="#a7506f" stroke="#a7506f" points="374,-24 244,-24 244,0 374,0 374,-24"/>
<text text-anchor="middle" x="309" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Type Bound Procedure</text>
</g>
<!-- Unknown Procedure Type -->
<g id="node5" class="node">
<title>Unknown Procedure Type</title>
<polygon fill="#777777" stroke="#777777" points="537.5,-24 392.5,-24 392.5,0 537.5,0 537.5,-24"/>
<text text-anchor="middle" x="465" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Unknown Procedure Type</text>
</g>
<!-- Program -->
<g id="node6" class="node">
<title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="614,-24 556,-24 556,0 614,0 614,-24"/>
<text text-anchor="middle" x="585" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node7" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="737.5,-24 632.5,-24 632.5,0 737.5,0 737.5,-24"/>
<text text-anchor="middle" x="685" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

<p>Solid arrows point from a procedure to one which it calls. Dashed 
arrows point from an interface to procedures which implement that interface.
This could include the module procedures in a generic interface or the
implementation in a submodule of an interface in a parent module.
</p>
 </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-header">
  <h3 class="card-title">Called by</h3>
      </div>
      <div class="card-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: proc~~lincob~~CalledByGraph Pages: 1 -->
<svg id="proclincobCalledByGraph" width="258pt" height="32pt"
 viewBox="0.00 0.00 258.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~lincob~~CalledByGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>proc~~lincob~~CalledByGraph</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-28 254,-28 254,4 -4,4"/>
<!-- proc~lincob -->
<g id="proc~~lincob~~CalledByGraph_node1" class="node">
<title>proc~lincob</title>
<polygon fill="none" stroke="black" points="250,-24 196,-24 196,0 250,0 250,-24"/>
<text text-anchor="middle" x="223" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">lincob</text>
</g>
<!-- proc~lincoa -->
<g id="proc~~lincob~~CalledByGraph_node2" class="node">
<title>proc~lincoa</title>
<g id="a_proc~~lincob~~CalledByGraph_node2"><a xlink:href="../proc/lincoa.html" xlink:title="lincoa">
<polygon fill="#d9534f" stroke="#d9534f" points="160,-24 106,-24 106,0 160,0 160,-24"/>
<text text-anchor="middle" x="133" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">lincoa</text>
</a>
</g>
</g>
<!-- proc~lincoa&#45;&gt;proc~lincob -->
<g id="proc~~lincob~~CalledByGraph_edge1" class="edge">
<title>proc~lincoa&#45;&gt;proc~lincob</title>
<path fill="none" stroke="#000000" d="M160.4,-12C168.39,-12 177.31,-12 185.82,-12"/>
<polygon fill="#000000" stroke="#000000" points="185.92,-15.5 195.92,-12 185.92,-8.5 185.92,-15.5"/>
</g>
<!-- proc~lincoa_test -->
<g id="proc~~lincob~~CalledByGraph_node3" class="node">
<title>proc~lincoa_test</title>
<g id="a_proc~~lincob~~CalledByGraph_node3"><a xlink:href="../proc/lincoa_test.html" xlink:title="lincoa_test">
<polygon fill="#d9534f" stroke="#d9534f" points="70,-24 0,-24 0,0 70,0 70,-24"/>
<text text-anchor="middle" x="35" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">lincoa_test</text>
</a>
</g>
</g>
<!-- proc~lincoa_test&#45;&gt;proc~lincoa -->
<g id="proc~~lincob~~CalledByGraph_edge2" class="edge">
<title>proc~lincoa_test&#45;&gt;proc~lincoa</title>
<path fill="none" stroke="#000000" d="M70.12,-12C78.38,-12 87.24,-12 95.6,-12"/>
<polygon fill="#000000" stroke="#000000" points="95.84,-15.5 105.84,-12 95.84,-8.5 95.84,-15.5"/>
</g>
</g>
</svg>
</div>          <div>
            <a type="button" class="graph-help" data-bs-toggle="modal" href="#CalledByGraph-help-text">Help</a>
          </div>
          <div class="modal fade" id="CalledByGraph-help-text" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-lg" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
<p>Nodes of different colours represent the following: </p>
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="641pt" height="28pt"
 viewBox="0.00 0.00 641.00 27.51" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.86 0.86) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-28 741.5,-28 741.5,4 -4,4"/>
<!-- Subroutine -->
<g id="node1" class="node">
<title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="70,-24 0,-24 0,0 70,0 70,-24"/>
<text text-anchor="middle" x="35" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Subroutine</text>
</g>
<!-- Function -->
<g id="node2" class="node">
<title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="146,-24 88,-24 88,0 146,0 146,-24"/>
<text text-anchor="middle" x="117" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Function</text>
</g>
<!-- Interface -->
<g id="node3" class="node">
<title>Interface</title>
<polygon fill="#a7506f" stroke="#a7506f" points="225.5,-24 164.5,-24 164.5,0 225.5,0 225.5,-24"/>
<text text-anchor="middle" x="195" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Interface</text>
</g>
<!-- Type Bound Procedure -->
<g id="node4" class="node">
<title>Type Bound Procedure</title>
<polygon fill="#a7506f" stroke="#a7506f" points="374,-24 244,-24 244,0 374,0 374,-24"/>
<text text-anchor="middle" x="309" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Type Bound Procedure</text>
</g>
<!-- Unknown Procedure Type -->
<g id="node5" class="node">
<title>Unknown Procedure Type</title>
<polygon fill="#777777" stroke="#777777" points="537.5,-24 392.5,-24 392.5,0 537.5,0 537.5,-24"/>
<text text-anchor="middle" x="465" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Unknown Procedure Type</text>
</g>
<!-- Program -->
<g id="node6" class="node">
<title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="614,-24 556,-24 556,0 614,0 614,-24"/>
<text text-anchor="middle" x="585" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node7" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="737.5,-24 632.5,-24 632.5,0 737.5,0 737.5,-24"/>
<text text-anchor="middle" x="685" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

<p>Solid arrows point from a procedure to one which it calls. Dashed 
arrows point from an interface to procedures which implement that interface.
This could include the module procedures in a generic interface or the
implementation in a submodule of an interface in a parent module.
</p>
 </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <br>


    
    

    
    



    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl codehilite"><pre><span></span><span class="w">    </span><span class="k">subroutine </span><span class="n">lincob</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">npt</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">amat</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">rhobeg</span><span class="p">,</span><span class="w"> </span><span class="n">rhoend</span><span class="p">,</span><span class="w"> </span><span class="n">iprint</span><span class="p">,</span><span class="w"> </span><span class="n">maxfun</span><span class="p">,</span><span class="w"> </span><span class="n">xbase</span><span class="p">,</span><span class="w"> </span><span class="n">xpt</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                       </span><span class="n">fval</span><span class="p">,</span><span class="w"> </span><span class="n">xsav</span><span class="p">,</span><span class="w"> </span><span class="n">xopt</span><span class="p">,</span><span class="w"> </span><span class="n">gopt</span><span class="p">,</span><span class="w"> </span><span class="n">hq</span><span class="p">,</span><span class="w"> </span><span class="n">pq</span><span class="p">,</span><span class="w"> </span><span class="n">bmat</span><span class="p">,</span><span class="w"> </span><span class="n">zmat</span><span class="p">,</span><span class="w"> </span><span class="n">ndim</span><span class="p">,</span><span class="w"> </span><span class="n">step</span><span class="p">,</span><span class="w"> </span><span class="n">sp</span><span class="p">,</span><span class="w"> </span><span class="n">xnew</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                       </span><span class="n">iact</span><span class="p">,</span><span class="w"> </span><span class="n">rescon</span><span class="p">,</span><span class="w"> </span><span class="n">qfac</span><span class="p">,</span><span class="w"> </span><span class="n">rfac</span><span class="p">,</span><span class="w"> </span><span class="n">pqw</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="n">calfun</span><span class="p">)</span>

<span class="w">        </span><span class="k">implicit </span><span class="kt">real</span><span class="w"> </span><span class="p">(</span><span class="n">wp</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="o">-</span><span class="n">z</span><span class="p">)</span>

<span class="w">        </span><span class="k">dimension </span><span class="n">amat</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="n">xbase</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="n">xpt</span><span class="w"> </span><span class="p">(</span><span class="n">npt</span><span class="p">,</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="n">fval</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="n">xsav</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                  </span><span class="n">xopt</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="n">gopt</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="n">hq</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="n">pq</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="n">bmat</span><span class="w"> </span><span class="p">(</span><span class="n">ndim</span><span class="p">,</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="n">zmat</span><span class="w"> </span><span class="p">(</span><span class="n">npt</span><span class="p">,</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                  </span><span class="n">step</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="n">xnew</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="n">iact</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="n">rescon</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="n">qfac</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="n">rfac</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                  </span><span class="n">pqw</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
<span class="w">        </span><span class="k">procedure</span><span class="w"> </span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">calfun</span>
<span class="c">!</span>
<span class="c">!     The arguments N, NPT, M, X, RHOBEG, RHOEND, IPRINT and MAXFUN are</span>
<span class="c">!       identical to the corresponding arguments in SUBROUTINE LINCOA.</span>
<span class="c">!     AMAT is a matrix whose columns are the constraint gradients, scaled</span>
<span class="c">!       so that they have unit length.</span>
<span class="c">!     B contains on entry the right hand sides of the constraints, scaled</span>
<span class="c">!       as above, but later B is modified for variables relative to XBASE.</span>
<span class="c">!     XBASE holds a shift of origin that should reduce the contributions</span>
<span class="c">!       from rounding errors to values of the model and Lagrange functions.</span>
<span class="c">!     XPT contains the interpolation point coordinates relative to XBASE.</span>
<span class="c">!     FVAL holds the values of F at the interpolation points.</span>
<span class="c">!     XSAV holds the best feasible vector of variables so far, without any</span>
<span class="c">!       shift of origin.</span>
<span class="c">!     XOPT is set to XSAV-XBASE, which is the displacement from XBASE of</span>
<span class="c">!       the feasible vector of variables that provides the least calculated</span>
<span class="c">!       F so far, this vector being the current trust region centre.</span>
<span class="c">!     GOPT holds the gradient of the quadratic model at XSAV = XBASE+XOPT.</span>
<span class="c">!     HQ holds the explicit second derivatives of the quadratic model.</span>
<span class="c">!     PQ contains the parameters of the implicit second derivatives of the</span>
<span class="c">!       quadratic model.</span>
<span class="c">!     BMAT holds the last N columns of the big inverse matrix H.</span>
<span class="c">!     ZMAT holds the factorization of the leading NPT by NPT submatrix</span>
<span class="c">!       of H, this factorization being ZMAT times Diag(DZ) times ZMAT^T,</span>
<span class="c">!       where the elements of DZ are plus or minus one, as specified by IDZ.</span>
<span class="c">!     NDIM is the first dimension of BMAT and has the value NPT+N.</span>
<span class="c">!     STEP is employed for trial steps from XOPT. It is also used for working</span>
<span class="c">!       space when XBASE is shifted and in PRELIM.</span>
<span class="c">!     SP is reserved for the scalar products XOPT^T XPT(K,.), K=1,2,...,NPT,</span>
<span class="c">!       followed by STEP^T XPT(K,.), K=1,2,...,NPT.</span>
<span class="c">!     XNEW is the displacement from XBASE of the vector of variables for</span>
<span class="c">!       the current calculation of F, except that SUBROUTINE TRSTEP uses it</span>
<span class="c">!       for working space.</span>
<span class="c">!     IACT is an integer array for the indices of the active constraints.</span>
<span class="c">!     RESCON holds useful information about the constraint residuals. Every</span>
<span class="c">!       nonnegative RESCON(J) is the residual of the J-th constraint at the</span>
<span class="c">!       current trust region centre. Otherwise, if RESCON(J) is negative, the</span>
<span class="c">!       J-th constraint holds as a strict inequality at the trust region</span>
<span class="c">!       centre, its residual being at least |RESCON(J)|; further, the value</span>
<span class="c">!       of |RESCON(J)| is at least the current trust region radius DELTA.</span>
<span class="c">!     QFAC is the orthogonal part of the QR factorization of the matrix of</span>
<span class="c">!       active constraint gradients, these gradients being ordered in</span>
<span class="c">!       accordance with IACT. When NACT is less than N, columns are added</span>
<span class="c">!       to QFAC to complete an N by N orthogonal matrix, which is important</span>
<span class="c">!       for keeping calculated steps sufficiently close to the boundaries</span>
<span class="c">!       of the active constraints.</span>
<span class="c">!     RFAC is the upper triangular part of this QR factorization, beginning</span>
<span class="c">!       with the first diagonal element, followed by the two elements in the</span>
<span class="c">!       upper triangular part of the second column and so on.</span>
<span class="c">!     PQW is used for working space, mainly for storing second derivative</span>
<span class="c">!       coefficients of quadratic functions. Its length is NPT+N.</span>
<span class="c">!     The array W is also used for working space. The required number of</span>
<span class="c">!       elements, namely MAX[M+3*N,2*M+N,2*NPT], is set in LINCOA.</span>
<span class="c">!</span>
<span class="c">!     Set some constants.</span>
<span class="c">!</span>
<span class="w">        </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">half</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5_wp</span>
<span class="w">        </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">one</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0_wp</span>
<span class="w">        </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tenth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.1_wp</span>
<span class="w">        </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">zero</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0_wp</span>

<span class="w">        </span><span class="n">np</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="n">nh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">np</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span>
<span class="w">        </span><span class="n">nptm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">npt</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">np</span>
<span class="c">!</span>
<span class="c">!     Set the elements of XBASE, XPT, FVAL, XSAV, XOPT, GOPT, HQ, PQ, BMAT,</span>
<span class="c">!       ZMAT and SP for the first iteration. An important feature is that,</span>
<span class="c">!       if the interpolation point XPT(K,.) is not feasible, where K is any</span>
<span class="c">!       integer from [1,NPT], then a change is made to XPT(K,.) if necessary</span>
<span class="c">!       so that the constraint violation is at least 0.2*RHOBEG. Also KOPT</span>
<span class="c">!       is set so that XPT(KOPT,.) is the initial trust region centre.</span>
<span class="c">!</span>
<span class="w">        </span><span class="k">call </span><span class="n">prelim</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">npt</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">amat</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">rhobeg</span><span class="p">,</span><span class="w"> </span><span class="n">iprint</span><span class="p">,</span><span class="w"> </span><span class="n">xbase</span><span class="p">,</span><span class="w"> </span><span class="n">xpt</span><span class="p">,</span><span class="w"> </span><span class="n">fval</span><span class="p">,</span><span class="w"> </span><span class="n">xsav</span><span class="p">,</span><span class="w"> </span><span class="n">xopt</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                     </span><span class="n">gopt</span><span class="p">,</span><span class="w"> </span><span class="n">kopt</span><span class="p">,</span><span class="w"> </span><span class="n">hq</span><span class="p">,</span><span class="w"> </span><span class="n">pq</span><span class="p">,</span><span class="w"> </span><span class="n">bmat</span><span class="p">,</span><span class="w"> </span><span class="n">zmat</span><span class="p">,</span><span class="w"> </span><span class="n">idz</span><span class="p">,</span><span class="w"> </span><span class="n">ndim</span><span class="p">,</span><span class="w"> </span><span class="n">sp</span><span class="p">,</span><span class="w"> </span><span class="n">rescon</span><span class="p">,</span><span class="w"> </span><span class="n">step</span><span class="p">,</span><span class="w"> </span><span class="n">pqw</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                     </span><span class="n">calfun</span><span class="p">)</span>
<span class="c">!</span>
<span class="c">!     Begin the iterative procedure.</span>
<span class="c">!</span>
<span class="w">        </span><span class="n">nf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">npt</span>
<span class="w">        </span><span class="n">fopt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fval</span><span class="w"> </span><span class="p">(</span><span class="n">kopt</span><span class="p">)</span>
<span class="w">        </span><span class="n">rho</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rhobeg</span>
<span class="w">        </span><span class="n">delta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rho</span>
<span class="w">        </span><span class="n">ifeas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="n">nact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="n">itest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span>
<span class="mi">10</span><span class="w">      </span><span class="n">knew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="n">nvala</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="n">nvalb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="c">!</span>
<span class="c">!     Shift XBASE if XOPT may be too far from XBASE. First make the changes</span>
<span class="c">!       to BMAT that do not depend on ZMAT.</span>
<span class="c">!</span>
<span class="mi">20</span><span class="w">      </span><span class="n">fsave</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fopt</span>
<span class="w">        </span><span class="n">xoptsq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">        </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">            </span><span class="n">xoptsq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xoptsq</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xopt</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="mi">2</span>
<span class="w">        </span><span class="k">end do</span>
<span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="n">xoptsq</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">1.0e4_wp</span><span class="o">*</span><span class="n">delta</span><span class="o">*</span><span class="n">delta</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">qoptsq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.25_wp</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">xoptsq</span>
<span class="w">            </span><span class="k">do </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">npt</span>
<span class="w">                </span><span class="nb">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">                </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                    </span><span class="nb">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xpt</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">xopt</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">                </span><span class="k">end do</span>
<span class="k">                </span><span class="nb">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sum</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">half</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">xoptsq</span>
<span class="w">                </span><span class="n">w</span><span class="w"> </span><span class="p">(</span><span class="n">npt</span><span class="o">+</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sum</span>
<span class="nb">                </span><span class="n">sp</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">                </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                    </span><span class="n">xpt</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xpt</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">half</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">xopt</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">                    </span><span class="n">step</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bmat</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span>
<span class="w">                    </span><span class="n">w</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sum</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">xpt</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">qoptsq</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">xopt</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">                    </span><span class="n">ip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">npt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span>
<span class="w">                    </span><span class="k">do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">i</span>
<span class="w">                        </span><span class="n">bmat</span><span class="w"> </span><span class="p">(</span><span class="n">ip</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bmat</span><span class="w"> </span><span class="p">(</span><span class="n">ip</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<span class="w">                    </span><span class="k">end do</span>
<span class="k">                end do</span>
<span class="k">            end do</span>
<span class="c">!</span>
<span class="c">!     Then the revisions of BMAT that depend on ZMAT are calculated.</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">do </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nptm</span>
<span class="w">                </span><span class="n">sumz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">                </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">npt</span>
<span class="w">                    </span><span class="n">sumz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sumz</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">zmat</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span>
<span class="w">                    </span><span class="n">w</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="p">(</span><span class="n">npt</span><span class="o">+</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zmat</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span>
<span class="w">                </span><span class="k">end do</span>
<span class="k">                do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                    </span><span class="nb">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">qoptsq</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sumz</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">xopt</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<span class="w">                    </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">npt</span>
<span class="w">                        </span><span class="nb">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">xpt</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span>
<span class="w">                    </span><span class="k">end do</span>
<span class="k">                    </span><span class="n">step</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sum</span>
<span class="nb">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">idz</span><span class="p">)</span><span class="w"> </span><span class="nb">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">sum</span>
<span class="nb">                    </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">npt</span>
<span class="w">                        </span><span class="n">bmat</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bmat</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">sum</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zmat</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span>
<span class="w">                    </span><span class="k">end do</span>
<span class="k">                end do</span>
<span class="k">                do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                    </span><span class="n">ip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">npt</span>
<span class="w">                    </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">idz</span><span class="p">)</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">temp</span>
<span class="w">                    </span><span class="k">do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">i</span>
<span class="w">                        </span><span class="n">bmat</span><span class="w"> </span><span class="p">(</span><span class="n">ip</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bmat</span><span class="w"> </span><span class="p">(</span><span class="n">ip</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<span class="w">                    </span><span class="k">end do</span>
<span class="k">                end do</span>
<span class="k">            end do</span>
<span class="c">!</span>
<span class="c">!     Update the right hand sides of the constraints.</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">m</span>
<span class="w">                    </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">                    </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                        </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">amat</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">xopt</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">                    </span><span class="k">end do</span>
<span class="k">                    </span><span class="n">b</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">temp</span>
<span class="w">                </span><span class="k">end do</span>
<span class="k">            end if</span>
<span class="c">!</span>
<span class="c">!     The following instructions complete the shift of XBASE, including the</span>
<span class="c">!       changes to the parameters of the quadratic model.</span>
<span class="c">!</span>
<span class="w">            </span><span class="n">ih</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">            </span><span class="k">do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                </span><span class="n">w</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">                </span><span class="k">do </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">npt</span>
<span class="w">                    </span><span class="n">w</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pq</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">xpt</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span>
<span class="w">                    </span><span class="n">xpt</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xpt</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">half</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">xopt</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<span class="w">                </span><span class="k">end do</span>
<span class="k">                do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">j</span>
<span class="w">                    </span><span class="n">ih</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ih</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                    </span><span class="n">hq</span><span class="w"> </span><span class="p">(</span><span class="n">ih</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hq</span><span class="w"> </span><span class="p">(</span><span class="n">ih</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">xopt</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xopt</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<span class="w">                    </span><span class="n">bmat</span><span class="w"> </span><span class="p">(</span><span class="n">npt</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bmat</span><span class="w"> </span><span class="p">(</span><span class="n">npt</span><span class="o">+</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span>
<span class="w">                </span><span class="k">end do</span>
<span class="k">            end do</span>
<span class="k">            do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                </span><span class="n">xbase</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xbase</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xopt</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<span class="w">                </span><span class="n">xopt</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">                </span><span class="n">xpt</span><span class="w"> </span><span class="p">(</span><span class="n">kopt</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">            </span><span class="k">end do</span>
<span class="k">        end if</span>
<span class="c">!</span>
<span class="c">!     In the case KNEW=0, generate the next trust region step by calling</span>
<span class="c">!       TRSTEP, where SNORM is the current trust region radius initially.</span>
<span class="c">!       The final value of SNORM is the length of the calculated step,</span>
<span class="c">!       except that SNORM is zero on return if the projected gradient is</span>
<span class="c">!       unsuitable for starting the conjugate gradient iterations.</span>
<span class="c">!</span>
<span class="w">        </span><span class="n">delsav</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">delta</span>
<span class="w">        </span><span class="n">ksave</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">knew</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">knew</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">snorm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">delta</span>
<span class="w">            </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                </span><span class="n">xnew</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gopt</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">            </span><span class="k">end do</span>
<span class="k">            call </span><span class="n">trstep</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">npt</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">amat</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">xpt</span><span class="p">,</span><span class="w"> </span><span class="n">hq</span><span class="p">,</span><span class="w"> </span><span class="n">pq</span><span class="p">,</span><span class="w"> </span><span class="n">nact</span><span class="p">,</span><span class="w"> </span><span class="n">iact</span><span class="p">,</span><span class="w"> </span><span class="n">rescon</span><span class="p">,</span><span class="w"> </span><span class="n">qfac</span><span class="p">,</span><span class="w"> </span><span class="n">rfac</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                         </span><span class="n">snorm</span><span class="p">,</span><span class="w"> </span><span class="n">step</span><span class="p">,</span><span class="w"> </span><span class="n">xnew</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">pqw</span><span class="p">,</span><span class="w"> </span><span class="n">pqw</span><span class="p">(</span><span class="n">np</span><span class="p">),</span><span class="w"> </span><span class="n">w</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="n">np</span><span class="p">))</span>
<span class="c">!</span>
<span class="c">!     A trust region step is applied whenever its length, namely SNORM, is at</span>
<span class="c">!       least HALF*DELTA. It is also applied if its length is at least 0.1999</span>
<span class="c">!       times DELTA and if a line search of TRSTEP has caused a change to the</span>
<span class="c">!       active set. Otherwise there is a branch below to label 530 or 560.</span>
<span class="c">!</span>
<span class="w">            </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">half</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">delta</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">xnew</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">half</span><span class="p">)</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.1999_wp</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">delta</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">snorm</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">temp</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">delta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">half</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">delta</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">delta</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">1.4_wp</span><span class="o">*</span><span class="n">rho</span><span class="p">)</span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rho</span>
<span class="w">                </span><span class="n">nvala</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nvala</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                </span><span class="n">nvalb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nvalb</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">snorm</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">rho</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">delsav</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">rho</span><span class="p">)</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">temp</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">half</span><span class="p">)</span><span class="w"> </span><span class="n">nvala</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">temp</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">tenth</span><span class="p">)</span><span class="w"> </span><span class="n">nvalb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">delsav</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">rho</span><span class="p">)</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">530</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nvala</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">nvalb</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">530</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">snorm</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">zero</span><span class="p">)</span><span class="w"> </span><span class="n">ksave</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">560</span>
<span class="w">            </span><span class="k">end if</span>
<span class="k">            </span><span class="n">nvala</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">            </span><span class="n">nvalb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="c">!</span>
<span class="c">!     Alternatively, KNEW is positive. Then the model step is calculated</span>
<span class="c">!       within a trust region of radius DEL, after setting the gradient at</span>
<span class="c">!       XBASE and the second derivative parameters of the KNEW-th Lagrange</span>
<span class="c">!       function in W(1) to W(N) and in PQW(1) to PQW(NPT), respectively.</span>
<span class="c">!</span>
<span class="w">        </span><span class="k">else</span>
<span class="k">            </span><span class="n">del</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="w"> </span><span class="p">(</span><span class="n">tenth</span><span class="o">*</span><span class="n">delta</span><span class="p">,</span><span class="w"> </span><span class="n">rho</span><span class="p">)</span>
<span class="w">            </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                </span><span class="n">w</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bmat</span><span class="w"> </span><span class="p">(</span><span class="n">knew</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span>
<span class="w">            </span><span class="k">end do</span>
<span class="k">            do </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">npt</span>
<span class="w">                </span><span class="n">pqw</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">            </span><span class="k">end do</span>
<span class="k">            do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nptm</span>
<span class="w">                </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zmat</span><span class="w"> </span><span class="p">(</span><span class="n">knew</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">idz</span><span class="p">)</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">temp</span>
<span class="w">                </span><span class="k">do </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">npt</span>
<span class="w">                    </span><span class="n">pqw</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pqw</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zmat</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span>
<span class="w">                </span><span class="k">end do</span>
<span class="k">            end do</span>
<span class="k">            call </span><span class="n">qmstep</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">npt</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">amat</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">xpt</span><span class="p">,</span><span class="w"> </span><span class="n">xopt</span><span class="p">,</span><span class="w"> </span><span class="n">nact</span><span class="p">,</span><span class="w"> </span><span class="n">iact</span><span class="p">,</span><span class="w"> </span><span class="n">rescon</span><span class="p">,</span><span class="w"> </span><span class="n">qfac</span><span class="p">,</span><span class="w"> </span><span class="n">kopt</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                         </span><span class="n">knew</span><span class="p">,</span><span class="w"> </span><span class="n">del</span><span class="p">,</span><span class="w"> </span><span class="n">step</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="n">pqw</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">(</span><span class="n">np</span><span class="p">),</span><span class="w"> </span><span class="n">w</span><span class="p">(</span><span class="n">np</span><span class="o">+</span><span class="n">m</span><span class="p">),</span><span class="w"> </span><span class="n">ifeas</span><span class="p">)</span>
<span class="w">        </span><span class="k">end if</span>
<span class="c">!</span>
<span class="c">!     Set VQUAD to the change to the quadratic model when the move STEP is</span>
<span class="c">!       made from XOPT. If STEP is a trust region step, then VQUAD should be</span>
<span class="c">!       negative. If it is nonnegative due to rounding errors in this case,</span>
<span class="c">!       there is a branch to label 530 to try to improve the model.</span>
<span class="c">!</span>
<span class="w">        </span><span class="n">vquad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">        </span><span class="n">ih</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="k">do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">            </span><span class="n">vquad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vquad</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">gopt</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<span class="w">            </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">j</span>
<span class="w">                </span><span class="n">ih</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ih</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">half</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">temp</span>
<span class="w">                </span><span class="n">vquad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vquad</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">hq</span><span class="w"> </span><span class="p">(</span><span class="n">ih</span><span class="p">)</span>
<span class="w">            </span><span class="k">end do</span>
<span class="k">        end do</span>
<span class="k">        do </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">npt</span>
<span class="w">            </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">            </span><span class="k">do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xpt</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<span class="w">                </span><span class="n">sp</span><span class="w"> </span><span class="p">(</span><span class="n">npt</span><span class="o">+</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span>
<span class="w">            </span><span class="k">end do</span>
<span class="k">            </span><span class="n">vquad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vquad</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">half</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pq</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">temp</span>
<span class="w">        </span><span class="k">end do</span>
<span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="n">ksave</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">vquad</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">zero</span><span class="p">)</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">530</span>
<span class="c">!</span>
<span class="c">!     Calculate the next value of the objective function. The difference</span>
<span class="c">!       between the actual new value of F and the value predicted by the</span>
<span class="c">!       model is recorded in DIFF.</span>
<span class="c">!</span>
<span class="mi">220</span><span class="w">     </span><span class="n">nf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nf</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nf</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">maxfun</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">nf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nf</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">iprint</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">print </span><span class="mi">230</span>
<span class="mi">230</span><span class="w">         </span><span class="k">format</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Return from LINCOA because CALFUN has been&#39;</span><span class="p">,&amp;</span>
<span class="w">            </span><span class="s1">&#39; called MAXFUN times.&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">600</span>
<span class="w">        </span><span class="k">end if</span>
<span class="k">        </span><span class="n">xdiff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">        </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">            </span><span class="n">xnew</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xopt</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">            </span><span class="n">x</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xbase</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">xnew</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">            </span><span class="n">xdiff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xdiff</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">-</span><span class="n">xsav</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="mi">2</span>
<span class="w">        </span><span class="k">end do</span>
<span class="k">        </span><span class="n">xdiff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="w"> </span><span class="p">(</span><span class="n">xdiff</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ksave</span><span class="w"> </span><span class="o">==-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">xdiff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rho</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">xdiff</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">tenth</span><span class="o">*</span><span class="n">rho</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">xdiff</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">delta</span><span class="o">+</span><span class="n">delta</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">ifeas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">iprint</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">print </span><span class="mi">250</span>
<span class="mi">250</span><span class="w">         </span><span class="k">format</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Return from LINCOA because rounding errors&#39;</span><span class="p">,&amp;</span>
<span class="w">            </span><span class="s1">&#39; prevent reasonable changes to X.&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">600</span>
<span class="w">        </span><span class="k">end if</span>
<span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="n">ksave</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">ifeas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">real</span><span class="w"> </span><span class="p">(</span><span class="n">ifeas</span><span class="p">,</span><span class="w"> </span><span class="n">wp</span><span class="p">)</span>
<span class="w">        </span><span class="k">call </span><span class="n">calfun</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">iprint</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            print </span><span class="mi">260</span><span class="p">,</span><span class="w"> </span><span class="n">nf</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="mi">260</span><span class="w">         </span><span class="k">format</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Function number&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">i6</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;    F =&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">pd18</span><span class="p">.</span><span class="mi">10</span><span class="p">,&amp;</span>
<span class="w">            </span><span class="s1">&#39;    The corresponding X is:&#39;</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="n">d15</span><span class="p">.</span><span class="mi">6</span><span class="p">))</span>
<span class="w">        </span><span class="k">end if</span>
<span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="n">ksave</span><span class="w"> </span><span class="o">==-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">600</span>
<span class="w">        </span><span class="n">diff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">fopt</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">vquad</span>
<span class="c">!</span>
<span class="c">!     If X is feasible, then set DFFALT to the difference between the new</span>
<span class="c">!       value of F and the value predicted by the alternative model.</span>
<span class="c">!</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ifeas</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">itest</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            do </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">npt</span>
<span class="w">                </span><span class="n">pqw</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">                </span><span class="n">w</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fval</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">fval</span><span class="w"> </span><span class="p">(</span><span class="n">kopt</span><span class="p">)</span>
<span class="w">            </span><span class="k">end do</span>
<span class="k">            do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nptm</span>
<span class="w">                </span><span class="nb">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">                </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">npt</span>
<span class="w">                    </span><span class="nb">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zmat</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span>
<span class="w">                </span><span class="k">end do</span>
<span class="k">                if</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">idz</span><span class="p">)</span><span class="w"> </span><span class="nb">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">sum</span>
<span class="nb">                </span><span class="k">do </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">npt</span>
<span class="w">                    </span><span class="n">pqw</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pqw</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">sum</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zmat</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span>
<span class="w">                </span><span class="k">end do</span>
<span class="k">            end do</span>
<span class="k">            </span><span class="n">vqalt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">            </span><span class="k">do </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">npt</span>
<span class="w">                </span><span class="nb">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">                </span><span class="k">do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                    </span><span class="nb">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">bmat</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<span class="w">                </span><span class="k">end do</span>
<span class="k">                </span><span class="n">vqalt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vqalt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">sum</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="w">                </span><span class="n">vqalt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vqalt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pqw</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">(</span><span class="n">npt</span><span class="o">+</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">half</span><span class="o">*</span><span class="n">sp</span><span class="p">(</span><span class="n">npt</span><span class="o">+</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="n">sp</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
<span class="w">            </span><span class="k">end do</span>
<span class="k">            </span><span class="n">dffalt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">fopt</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">vqalt</span>
<span class="w">        </span><span class="k">end if</span>
<span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="n">itest</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">dffalt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">diff</span>
<span class="w">            </span><span class="n">itest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="k">end if</span>
<span class="c">!</span>
<span class="c">!     Pick the next value of DELTA after a trust region step.</span>
<span class="c">!</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ksave</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">ratio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="o">-</span><span class="n">fopt</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">vquad</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ratio</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">tenth</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">delta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">half</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">delta</span>
<span class="w">            </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="n">ratio</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0.7_wp</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">delta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="w"> </span><span class="p">(</span><span class="n">half</span><span class="o">*</span><span class="n">delta</span><span class="p">,</span><span class="w"> </span><span class="n">snorm</span><span class="p">)</span>
<span class="w">            </span><span class="k">else</span>
<span class="k">                </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="w"> </span><span class="p">(</span><span class="mf">2.0_wp</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">delta</span>
<span class="w">                </span><span class="n">delta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="w"> </span><span class="p">(</span><span class="n">half</span><span class="o">*</span><span class="n">delta</span><span class="p">,</span><span class="w"> </span><span class="n">snorm</span><span class="o">+</span><span class="n">snorm</span><span class="p">)</span>
<span class="w">                </span><span class="n">delta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="w"> </span><span class="p">(</span><span class="n">delta</span><span class="p">,</span><span class="w"> </span><span class="n">temp</span><span class="p">)</span>
<span class="w">            </span><span class="k">end if</span>
<span class="k">            if</span><span class="w"> </span><span class="p">(</span><span class="n">delta</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">1.4_wp</span><span class="o">*</span><span class="n">rho</span><span class="p">)</span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rho</span>
<span class="w">        </span><span class="k">end if</span>
<span class="c">!</span>
<span class="c">!     Update BMAT, ZMAT and IDZ, so that the KNEW-th interpolation point</span>
<span class="c">!       can be moved. If STEP is a trust region step, then KNEW is zero at</span>
<span class="c">!       present, but a positive value is picked by subroutine UPDATE.</span>
<span class="c">!</span>
<span class="w">        </span><span class="k">call </span><span class="n">update</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">npt</span><span class="p">,</span><span class="w"> </span><span class="n">xpt</span><span class="p">,</span><span class="w"> </span><span class="n">bmat</span><span class="p">,</span><span class="w"> </span><span class="n">zmat</span><span class="p">,</span><span class="w"> </span><span class="n">idz</span><span class="p">,</span><span class="w"> </span><span class="n">ndim</span><span class="p">,</span><span class="w"> </span><span class="n">sp</span><span class="p">,</span><span class="w"> </span><span class="n">step</span><span class="p">,</span><span class="w"> </span><span class="n">kopt</span><span class="p">,</span><span class="w"> </span><span class="n">knew</span><span class="p">,</span><span class="w"> </span><span class="n">pqw</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">knew</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            if</span><span class="w"> </span><span class="p">(</span><span class="n">iprint</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">print </span><span class="mi">320</span>
<span class="mi">320</span><span class="w">         </span><span class="k">format</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">            </span><span class="s1">&#39;Return from LINCOA because the denominator of the updating formula is zero.&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">600</span>
<span class="w">        </span><span class="k">end if</span>
<span class="c">!</span>
<span class="c">!     If ITEST is increased to 3, then the next quadratic model is the</span>
<span class="c">!       one whose second derivative matrix is least subject to the new</span>
<span class="c">!       interpolation conditions. Otherwise the new model is constructed</span>
<span class="c">!       by the symmetric Broyden method in the usual way.</span>
<span class="c">!</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ifeas</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">itest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itest</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">dffalt</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">tenth</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">diff</span><span class="p">))</span><span class="w"> </span><span class="n">itest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="k">end if</span>
<span class="c">!</span>
<span class="c">!     Update the second derivatives of the model by the symmetric Broyden</span>
<span class="c">!       method, using PQW for the second derivative parameters of the new</span>
<span class="c">!       KNEW-th Lagrange function. The contribution from the old parameter</span>
<span class="c">!       PQ(KNEW) is included in the second derivative matrix HQ. W is used</span>
<span class="c">!       later for the gradient of the new KNEW-th Lagrange function.</span>
<span class="c">!</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">itest</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            do </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">npt</span>
<span class="w">                </span><span class="n">pqw</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">            </span><span class="k">end do</span>
<span class="k">            do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nptm</span>
<span class="w">                </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zmat</span><span class="w"> </span><span class="p">(</span><span class="n">knew</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">temp</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">zero</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    if</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">idz</span><span class="p">)</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">temp</span>
<span class="w">                    </span><span class="k">do </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">npt</span>
<span class="w">                        </span><span class="n">pqw</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pqw</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zmat</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span>
<span class="w">                    </span><span class="k">end do</span>
<span class="k">                end if</span>
<span class="k">            end do</span>
<span class="k">            </span><span class="n">ih</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">            </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                </span><span class="n">w</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bmat</span><span class="w"> </span><span class="p">(</span><span class="n">knew</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span>
<span class="w">                </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pq</span><span class="w"> </span><span class="p">(</span><span class="n">knew</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">xpt</span><span class="w"> </span><span class="p">(</span><span class="n">knew</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span>
<span class="w">                </span><span class="k">do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">i</span>
<span class="w">                    </span><span class="n">ih</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ih</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                    </span><span class="n">hq</span><span class="w"> </span><span class="p">(</span><span class="n">ih</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hq</span><span class="w"> </span><span class="p">(</span><span class="n">ih</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">xpt</span><span class="w"> </span><span class="p">(</span><span class="n">knew</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span>
<span class="w">                </span><span class="k">end do</span>
<span class="k">            end do</span>
<span class="k">            </span><span class="n">pq</span><span class="w"> </span><span class="p">(</span><span class="n">knew</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">            </span><span class="k">do </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">npt</span>
<span class="w">                </span><span class="n">pq</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pq</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">diff</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pqw</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="w">            </span><span class="k">end do</span>
<span class="k">        end if</span>
<span class="c">!</span>
<span class="c">!     Include the new interpolation point with the corresponding updates of</span>
<span class="c">!       SP. Also make the changes of the symmetric Broyden method to GOPT at</span>
<span class="c">!       the old XOPT if ITEST is less than 3.</span>
<span class="c">!</span>
<span class="w">        </span><span class="n">fval</span><span class="w"> </span><span class="p">(</span><span class="n">knew</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span>
<span class="w">        </span><span class="n">sp</span><span class="w"> </span><span class="p">(</span><span class="n">knew</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">(</span><span class="n">kopt</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">(</span><span class="n">npt</span><span class="o">+</span><span class="n">kopt</span><span class="p">)</span>
<span class="w">        </span><span class="n">ssq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">        </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">            </span><span class="n">xpt</span><span class="w"> </span><span class="p">(</span><span class="n">knew</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xnew</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">            </span><span class="n">ssq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ssq</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="mi">2</span>
<span class="w">        </span><span class="k">end do</span>
<span class="k">        </span><span class="n">sp</span><span class="w"> </span><span class="p">(</span><span class="n">npt</span><span class="o">+</span><span class="n">knew</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">(</span><span class="n">npt</span><span class="o">+</span><span class="n">kopt</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ssq</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">itest</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            do </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">npt</span>
<span class="w">                </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pqw</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="w">                </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                    </span><span class="n">w</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">xpt</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span>
<span class="w">                </span><span class="k">end do</span>
<span class="k">            end do</span>
<span class="k">            do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                </span><span class="n">gopt</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gopt</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">diff</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">            </span><span class="k">end do</span>
<span class="k">        end if</span>
<span class="c">!</span>
<span class="c">!     Update FOPT, XSAV, XOPT, KOPT, RESCON and SP if the new F is the</span>
<span class="c">!       least calculated value so far with a feasible vector of variables.</span>
<span class="c">!</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">fopt</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">ifeas</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">fopt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span>
<span class="w">            </span><span class="k">do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                </span><span class="n">xsav</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<span class="w">                </span><span class="n">xopt</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xnew</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<span class="w">            </span><span class="k">end do</span>
<span class="k">            </span><span class="n">kopt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">knew</span>
<span class="w">            </span><span class="n">snorm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="w"> </span><span class="p">(</span><span class="n">ssq</span><span class="p">)</span>
<span class="w">            </span><span class="k">do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">m</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rescon</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">delta</span><span class="o">+</span><span class="n">snorm</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    </span><span class="n">rescon</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">snorm</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rescon</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<span class="w">                </span><span class="k">else</span>
<span class="k">                    </span><span class="n">rescon</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rescon</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">snorm</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rescon</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="n">delta</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">zero</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                        </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<span class="w">                        </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                            </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">xopt</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">amat</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span>
<span class="w">                        </span><span class="k">end do</span>
<span class="k">                        </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="w"> </span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">)</span>
<span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">temp</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">delta</span><span class="p">)</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">temp</span>
<span class="w">                        </span><span class="n">rescon</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span>
<span class="w">                    </span><span class="k">end if</span>
<span class="k">                end if</span>
<span class="k">            end do</span>
<span class="k">            do </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">npt</span>
<span class="w">                </span><span class="n">sp</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">(</span><span class="n">npt</span><span class="o">+</span><span class="n">k</span><span class="p">)</span>
<span class="w">            </span><span class="k">end do</span>
<span class="c">!</span>
<span class="c">!     Also revise GOPT when symmetric Broyden updating is applied.</span>
<span class="c">!</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">itest</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">ih</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">                </span><span class="k">do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                    </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">j</span>
<span class="w">                        </span><span class="n">ih</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ih</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="n">gopt</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gopt</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">hq</span><span class="w"> </span><span class="p">(</span><span class="n">ih</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">                        </span><span class="n">gopt</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gopt</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">hq</span><span class="w"> </span><span class="p">(</span><span class="n">ih</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<span class="w">                    </span><span class="k">end do</span>
<span class="k">                end do</span>
<span class="k">                do </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">npt</span>
<span class="w">                    </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pq</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">(</span><span class="n">npt</span><span class="o">+</span><span class="n">k</span><span class="p">)</span>
<span class="w">                    </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                        </span><span class="n">gopt</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gopt</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">xpt</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span>
<span class="w">                    </span><span class="k">end do</span>
<span class="k">                end do</span>
<span class="k">            end if</span>
<span class="k">        end if</span>
<span class="c">!</span>
<span class="c">!     Replace the current model by the least Frobenius norm interpolant if</span>
<span class="c">!       this interpolant gives substantial reductions in the predictions</span>
<span class="c">!       of values of F at feasible points.</span>
<span class="c">!</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">itest</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            do </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">npt</span>
<span class="w">                </span><span class="n">pq</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">                </span><span class="n">w</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fval</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">fval</span><span class="w"> </span><span class="p">(</span><span class="n">kopt</span><span class="p">)</span>
<span class="w">            </span><span class="k">end do</span>
<span class="k">            do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nptm</span>
<span class="w">                </span><span class="nb">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">                </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">npt</span>
<span class="w">                    </span><span class="nb">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zmat</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span>
<span class="w">                </span><span class="k">end do</span>
<span class="k">                if</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">idz</span><span class="p">)</span><span class="w"> </span><span class="nb">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">sum</span>
<span class="nb">                </span><span class="k">do </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">npt</span>
<span class="w">                    </span><span class="n">pq</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pq</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">sum</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zmat</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span>
<span class="w">                </span><span class="k">end do</span>
<span class="k">            end do</span>
<span class="k">            do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                </span><span class="n">gopt</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">                </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">npt</span>
<span class="w">                    </span><span class="n">gopt</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gopt</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">bmat</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span>
<span class="w">                </span><span class="k">end do</span>
<span class="k">            end do</span>
<span class="k">            do </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">npt</span>
<span class="w">                </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pq</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="w">                </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                    </span><span class="n">gopt</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gopt</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">xpt</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span>
<span class="w">                </span><span class="k">end do</span>
<span class="k">            end do</span>
<span class="k">            do </span><span class="n">ih</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nh</span>
<span class="w">                </span><span class="n">hq</span><span class="w"> </span><span class="p">(</span><span class="n">ih</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">            </span><span class="k">end do</span>
<span class="k">        end if</span>
<span class="c">!</span>
<span class="c">!     If a trust region step has provided a sufficient decrease in F, then</span>
<span class="c">!       branch for another trust region calculation. Every iteration that</span>
<span class="c">!       takes a model step is followed by an attempt to take a trust region</span>
<span class="c">!       step.</span>
<span class="c">!</span>
<span class="w">        </span><span class="n">knew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ksave</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">20</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ratio</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">tenth</span><span class="p">)</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">20</span>
<span class="c">!</span>
<span class="c">!     Alternatively, find out if the interpolation points are close enough</span>
<span class="c">!       to the best point so far.</span>
<span class="c">!</span>
<span class="mi">530</span><span class="w">     </span><span class="n">distsq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="w"> </span><span class="p">(</span><span class="n">delta</span><span class="o">*</span><span class="n">delta</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0_wp</span><span class="o">*</span><span class="n">rho</span><span class="o">*</span><span class="n">rho</span><span class="p">)</span>
<span class="w">        </span><span class="k">do </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">npt</span>
<span class="w">            </span><span class="nb">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">            </span><span class="k">do </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                </span><span class="nb">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">xpt</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="o">-</span><span class="n">xopt</span><span class="p">(</span><span class="n">j</span><span class="p">))</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="mi">2</span>
<span class="w">            </span><span class="k">end do</span>
<span class="k">            if</span><span class="w"> </span><span class="p">(</span><span class="nb">sum</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">distsq</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">knew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span>
<span class="w">                </span><span class="n">distsq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sum</span>
<span class="nb">            </span><span class="k">end if</span>
<span class="k">        end do</span>
<span class="c">!</span>
<span class="c">!     If KNEW is positive, then branch back for the next iteration, which</span>
<span class="c">!       will generate a &quot;model step&quot;. Otherwise, if the current iteration</span>
<span class="c">!       has reduced F, or if DELTA was above its lower bound when the last</span>
<span class="c">!       trust region step was calculated, then try a &quot;trust region&quot; step</span>
<span class="c">!       instead.</span>
<span class="c">!</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">knew</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">20</span>
<span class="w">        </span><span class="n">knew</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fopt</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">fsave</span><span class="p">)</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">20</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">delsav</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">rho</span><span class="p">)</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">20</span>
<span class="c">!</span>
<span class="c">!     The calculations with the current value of RHO are complete.</span>
<span class="c">!       Pick the next value of RHO.</span>
<span class="c">!</span>
<span class="mi">560</span><span class="w">     </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rho</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">rhoend</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">delta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">half</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rho</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rho</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">25</span><span class="mf">0.0_wp</span><span class="o">*</span><span class="n">rhoend</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">rho</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tenth</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rho</span>
<span class="w">            </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="n">rho</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">1</span><span class="mf">6.0_wp</span><span class="o">*</span><span class="n">rhoend</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                </span><span class="n">rho</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rhoend</span>
<span class="w">            </span><span class="k">else</span>
<span class="k">                </span><span class="n">rho</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="w"> </span><span class="p">(</span><span class="n">rho</span><span class="o">*</span><span class="n">rhoend</span><span class="p">)</span>
<span class="w">            </span><span class="k">end if</span>
<span class="k">            </span><span class="n">delta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="w"> </span><span class="p">(</span><span class="n">delta</span><span class="p">,</span><span class="w"> </span><span class="n">rho</span><span class="p">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">iprint</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                if</span><span class="w"> </span><span class="p">(</span><span class="n">iprint</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">print </span><span class="mi">570</span>
<span class="mi">570</span><span class="w">             </span><span class="k">format</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">                </span><span class="k">print </span><span class="mi">580</span><span class="p">,</span><span class="w"> </span><span class="n">rho</span><span class="p">,</span><span class="w"> </span><span class="n">nf</span>
<span class="mi">580</span><span class="w">             </span><span class="k">format</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;New RHO =&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">pd11</span><span class="p">.</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Number of&#39;</span><span class="p">,&amp;</span>
<span class="w">                </span><span class="s1">&#39; function values =&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">i6</span><span class="p">)</span>
<span class="w">                </span><span class="k">print </span><span class="mi">590</span><span class="p">,</span><span class="w"> </span><span class="n">fopt</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">xbase</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="n">xopt</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="mi">590</span><span class="w">             </span><span class="k">format</span><span class="w"> </span><span class="p">(</span><span class="mi">4</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Least value of F =&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">pd23</span><span class="p">.</span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="n">x</span><span class="p">,&amp;</span>
<span class="w">                </span><span class="s1">&#39;The corresponding X is:&#39;</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="n">d15</span><span class="p">.</span><span class="mi">6</span><span class="p">))</span>
<span class="w">            </span><span class="k">end if</span>
<span class="k">            go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">10</span>
<span class="w">        </span><span class="k">end if</span>
<span class="c">!</span>
<span class="c">!     Return from the calculation, after branching to label 220 for another</span>
<span class="c">!       Newton-Raphson step if it has not been tried before.</span>
<span class="c">!</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ksave</span><span class="w"> </span><span class="o">==-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">220</span>
<span class="mi">600</span><span class="w">     </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fopt</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">ifeas</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                </span><span class="n">x</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xsav</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="w">            </span><span class="k">end do</span>
<span class="k">            </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fopt</span>
<span class="w">        </span><span class="k">end if</span>
<span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="n">iprint</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            print </span><span class="mi">620</span><span class="p">,</span><span class="w"> </span><span class="n">nf</span>
<span class="mi">620</span><span class="w">         </span><span class="k">format</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;At the return from LINCOA&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="n">x</span><span class="p">,&amp;</span>
<span class="w">            </span><span class="s1">&#39;Number of function values =&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">i6</span><span class="p">)</span>
<span class="w">            </span><span class="k">print </span><span class="mi">590</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="w">        </span><span class="k">end if</span>
<span class="k">        </span><span class="n">w</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span>
<span class="w">        </span><span class="n">w</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">real</span><span class="w"> </span><span class="p">(</span><span class="n">nf</span><span class="p">,</span><span class="w"> </span><span class="n">wp</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">half</span>

<span class="w">    </span><span class="k">end subroutine </span><span class="n">lincob</span>
</pre></div>

    </section>
    <br>
    
    </div>
  </div>

      <hr>
    </div> <!-- /container -->
    <footer>
      <div class="container">
        <div class="row justify-content-between">
          <div class="col">
            <p>
              PowellOpt
 was developed by Jacob Williams<br>              &copy; 2025 
</p>
          </div>
          <div class="col">
            <p class="text-end">
              Documentation generated by
              <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
            </p>
          </div>
        </div>
        <br>
      </div> <!-- /container -->
    </footer>

    <!-- Bootstrap core JavaScript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>    

    <!-- MathJax JavaScript
             ================================================== -->
             <!-- Placed at the end of the document so the pages load faster -->
        <script type="text/x-mathjax-config">
          MathJax.Hub.Config({
          TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
          jax: ['input/TeX','input/MathML','output/HTML-CSS'],
          extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
          });
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

          <script src="../tipuesearch/tipuesearch_content.js"></script>
          <script src="../tipuesearch/tipuesearch_set.js"></script>
          <script src="../tipuesearch/tipuesearch.js"></script>

  </body>
</html>